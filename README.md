# APML
Bayesian Machine Learning Project - Inspired by TrueSkill Rating system for ranking players in Online games such as HALO 2
#Questions:-

Introduction
In this project, you will work through the whole process of solving a real-world problem using
probabilistic machine learning. You are tasked to estimate the skill of players involved in a competition
based on the results of matches between pairs of players . You will first define a probabilistic model,
where all the quantities are represented as random variables, based on the Trueskill Bayesian ranking
system developed by Microsoft research for raking on-line matches. The model assigns a skill to each
player, in the form of a Gaussian random variable. When two players meet in a match, the outcome of
that match is a Gaussian random variable with mean equal to the difference between the two players’
skills. The result of the match is 1 (indicating the victory of Player 1) if the outcome is greater than
zero, -1 if it is less than zero (indicating the victory of Player 2).
You will use Bayesian inference to find the posterior distribution of the players’ skills given observations
of the results of matches. Because the posterior distribution is intractable, you will use two
different approximation methods based on graphical models.
On the course website, you will find the SerieA.csv dataset3 containing the results of the Italian
2018/2019 Serie A elite football (soccer) division; however, the Trueskill model can be used to solve
a variety of skill and ranking problems. Later in the project you will be asked to use a dataset of
games/competitions of your choosing. We suggest that you start thinking about it early on!
All relevant information needs to be well
explained in the six pages of the report; eventual additional pages can be added but will not be used
in the grading.

Q.1 Modeling (Lecture 2)
Formulate the Trueskill Bayesian model for one match between two players. The model consists
of four random variables, two Gaussian random variables s1 and s2 for the skills of the players,
one Gaussian random variable t, with mean s1 􀀀 s2, for the outcome of the game, and one discrete
random variable y = sign(t) for the result of the game (there is no possibility of a draw between
the players). Note that there are 5 hyperparameters in the model whose values you have to set. You
can read about TrueSkill on the Microsoft research website4, on the original publication5, or on Jeff
Moser’s website6.
3http://www.it.uu.se/edu/course/homepage/apml/project/SerieA.csv (accessed: 29 Aug
2019)
4https://www.microsoft.com/en-us/research/project/trueskill-ranking-system (accessed:
14 Jun 2019)
5Herbrich, Minka, Graepel, “TrueSkill(TM): A Bayesian Skill Rating System,” Advances in Neural Information
Processing Systems, January 2007, MIT Press
6http://www.moserware.com/2010/03/computing-your-skill.html (accessed 18 Jun 2019)

Q.2 Computing with the model
Using results on Gaussian random variables, compute
-> p(s1; s2jt; y): the full conditional distribution of the skills,
-> p(tjs1; s2; y): the full conditional distribution of the outcome,
-> p(y = 1) the marginal probability that Player 1 wins the game. Hint: p(y = 1) = p(t > 0).

Q.3 Bayesian Network
Draw the Bayesian network of the model from Q.1 and identify two conditionally independent sets of
variables.

Q.4 A first Gibbs sampler 
In this question, you will implement a method based on Gibbs sampling to compute the posterior
distribution of the skills s1 and s2 given the result of one match y.
Using the results of Q.2 and Q.3, implement a Gibbs sampler that targets the posterior distribution
p(s1; s2jy) of the skills given the result of one game between two players. Consider the same prior
distributions for the two players (p(s1) and p(s2) have the same hyperparameters).
-> Only the stationary distibution of the Gibbs sampler represents the posterior distribution of
the skills. Initial samples will depend on the initial condition of the chain and may be far
away from the stationary distribution and should be discarded (the so called burn-in).
Plot the samples of the posterior distributions generated by the Gibbs sampler when y = 1
(Player 1 wins). What seems to be a reasonable value for the burn-in? Comment on your
choice of burn-in. Then, re-run the experiment. Was your burn-in a good choice also for the
second run? Comment.
-> To recover the Trueskill representation of skills as Gaussian random variables, we need to
transform the samples drawn from the Gibbs sampler into Gaussian distributions. Implement
a function that uses the mean and covariance of the samples drawn by the Gibbs sampler to
find a Gaussian approximation of the posterior distribution of the skills.
-> When deciding how many samples to use (after burn-in), there is a tradeoff between accuracy
of the estimate and computational time. Plot the histogram of the samples generated (after
burn-in) together with the fitted Gaussian posterior for at least four (4) different numbers of
samples and report the time required to draw the samples. What is a reasonable number of
samples? Comment on your choice.
-> Compare the prior p(s1) with the Gaussian approximation of the posterior p(s1jy = 1);
similarly compare p(s2) with p(s2jy = 1). What has happened? Comment.

Q.5 Assumed Density Filtering 
The Gibbs sampler from Q.4 processes the result of one match to give a posterior distribution of
the skills given the match. We can use this posterior distribution as a prior for the next match in
what is commonly known as assumed density filtering (ADF). In this way, we can process a stream
of different matches between the players, each time using the posterior distribution of the previous
match as the prior for the current match.
-> Use ADF with Gibbs sampling to process the matches in the SerieA dataset and estimate
the skill of all the teams in the dataset (each team is one Player with an associated skill si).
Note that there are draws in the dataset! For now, skip these matches and suppose that they
leave the skill unchanged for both players.
What is the final ranking? Present the results in a suitable way. How can you interpret the
variance of the final skills?
-> Change the order of the matches in the SerieA dataset at random and re-run ADF. Does the
result change? Why?

Q.6 Using the model for predictions (Lecture 4)
Being a Bayesian model, Trueskill can be used to answer probabilistic questions such as “what is the
probability that Player 1 wins against Player 2?”. In particular, we can make predictions based on
these probabilities. Invent a prediction function that returns +1 if the Player 1 will win and 􀀀1 if the
Player 2 will win (note that you are only allowed to use the information of previous matches in this
prediction!).
Using the SerieA dataset, compute the one-step-ahead predictions of the results based on the model
and compare with the actual results for all matches; for each match
1. compute the prediction and compare to the result in the dataset,
2. update the model using the new match,
3. iterate over the whole dataset.
Report the prediction rate
r = number of correct guesses/number of total guesses
of your method over the whole dataset. Is it better than random guessing?

Q.7 Factor graph
Draw the Factor graph of the model and identify the messages. Write explicit forms for the messages
in the model and define a protocol for message passing. Hints:
-> you may want to add a variable w = s1 - s2 to the model, representing the difference of
skills between the players (the mean outcome),
-> one of the messages is a truncated Gaussian,
-> the final graph should have 5 variable nodes and 5 factor nodes.

Q.8 A message-passing algorithm 
Use moment-matching to approximate the truncated Gaussian message with a Gaussian message.
Implement the message-passing algorithm to compute the posterior distribution of the skills given the
result of one game between two players. Plot the posteriors computed with message passing. In the
same plot, show also the histogram and the Gaussian approximation from Gibbs sampling. Are the
posteriors the same? Why/why not? Comment!

Q.9 Your own data
Test the Trueskill methods you have developed on a dataset of your own choosing. Some suggestions
are other team sports (e.g., hockey, basketball, rugby), two-player sports (e.g. tennis), tabletop games,
or computer games. Include details about the source of the data and any pre-processing you have
done. Be creative!

Q.10 Open-ended project extension
In implementing Trueskill, you may have noticed that both the model and the inference algorithms
have limitations. In this part of the project you are free to define your own extensions of the model
and of the method in some way you find interesting. For example, the model may be tuned more to
the specific competition considered:
-> Model draws?
-> Does one of the players have an advantage a-priori (e.g., white in chess)?
-> Should skill change over time?

Implement at least one extension on the model and test it on the datasets. Do the results change? Can
you get better prediction rates?
